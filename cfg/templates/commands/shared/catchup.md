---
description: "收集多模块仓库中所有未提交更改作为上下文，便于追踪和分析当前工作状态"
argument-hint: "<可选：针对这些变更的问题或关注点>"
---

你现在处于「Catchup 模式」。

目标：收集当前工作目录下主仓库及所有 git submodules 中的未提交更改，整理为结构化的上下文信息，便于后续分析和问答。

## 一、执行步骤

### 1. 检查主仓库状态

依次执行以下命令，收集主仓库信息：

```bash
# 获取当前分支名
git branch --show-current

# 获取文件状态列表（包含状态码）
git status --short

# 获取 diff 统计信息（文件级别的增删行数）
git diff --stat
git diff --cached --stat
```

### 2. 遍历 Submodules

```bash
# 获取所有 submodule 列表及状态
git submodule status
```

对每个已初始化的 submodule（路径前无 `-` 标记的）：
- 进入该目录
- 检查是否为有效 git 工作目录（存在 `.git` 文件或目录）
- 执行与主仓库相同的状态收集命令
- 无权限访问或未初始化的 submodule 跳过，并在输出中注明

### 3. 整理输出

将收集到的信息整理为以下结构化格式：

```markdown
# 📋 Catchup 上下文摘要

**工作目录**: `<cwd>`
**扫描时间**: <时间戳>
**仓库数量**: N 个（主仓库 + M 个 submodules）
**变更文件总数**: X 个

---

## 📦 <仓库名称> [<分支名>]

**路径**: `<仓库绝对路径>`

### 变更文件

| 状态 | 文件路径 | +/- |
|------|----------|-----|
| M    | `<仓库路径>/path/to/modified.ts` | +10 -5 |
| A    | `<仓库路径>/path/to/added.ts` | +50 |
| D    | `<仓库路径>/path/to/deleted.ts` | -30 |
| ??   | `<仓库路径>/path/to/untracked.ts` | (new) |

---

## ⚠️ 跳过的 Submodules

| Submodule | 原因 |
|-----------|------|
| path/to/sub1 | 未初始化 |
| path/to/sub2 | 无访问权限 |
```

## 二、状态码说明

| 状态码 | 含义 |
|--------|------|
| M | 已修改（Modified） |
| A | 已添加到暂存区（Added） |
| D | 已删除（Deleted） |
| R | 重命名（Renamed） |
| C | 复制（Copied） |
| U | 更新但未合并（Unmerged） |
| ?? | 未跟踪（Untracked） |
| !! | 被忽略（Ignored） |

第一列表示暂存区状态，第二列表示工作区状态。

## 三、关于 Diff 详情

**重要**：输出中只列出变更文件的完整绝对路径和增删行数统计，不直接输出 diff 内容。

如果需要查看某个文件的具体变更内容：
- 使用 `Read` 工具读取该文件当前内容
- 或执行 `git diff <文件路径>` 查看具体变更

这样做的好处：
1. 保持上下文简洁，避免大量 diff 占用 token
2. Agent 可以按需选择性地深入查看关键文件
3. 文件路径是绝对路径，可直接用于 Read 工具

## 四、后续交互

在输出完成后：

1. 如果用户提供了 `$ARGUMENTS`（问题或关注点），根据需要使用 `Read` 工具读取相关文件后进行分析回答
2. 如果没有提供参数，提示用户可以针对这些变更提问，例如：
   - "这些变更的主要目的是什么？"
   - "有哪些潜在的风险或问题？"
   - "帮我写一个 commit message"
   - "这些变更是否完整，有遗漏吗？"
   - "帮我 review 一下 `<具体文件路径>`"
