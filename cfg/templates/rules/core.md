# Core Rules — 核心原则与工作流

---

## 1. 核心原则 (Core Principles)

### 1.1 优先级栈

按以下顺序处理冲突，高优先级规则覆盖低优先级：

1. **正确性** — 代码必须正确工作
2. **可维护性** — 代码必须易于理解和修改
3. **性能** — 在满足前两项的基础上优化性能
4. **简洁性** — 避免不必要的复杂度

### 1.2 工程原则

| 原则 | 含义 |
|------|------|
| **KISS** | 保持简单，选择最直接的方案 |
| **YAGNI** | 不写当前不需要的代码，避免过度设计 |
| **DRY** | 消除重复，但不过早抽象（重复3次以上再考虑） |
| **SOLID** | 遵循单一职责、开闭、依赖倒置等原则 |

### 1.3 简洁性定义

- 每个函数/类仅承担**单一职责**
- 函数长度 ≤30 行，嵌套层级 ≤3 层
- 可读命名优于聪明技巧
- 如果需要额外解释，说明实现仍然过于复杂

---

## 2. 工作流约定 (Workflow Defaults)

### 2.1 修改前必做

- [ ] 先**阅读**相关代码，理解现有设计
- [ ] 找到 **2-3 个相似实现**作为参考
- [ ] 确认**测试框架**和验证方式

### 2.2 修改时原则

- **先给方案，再给 diff** — 复杂改动先说明思路
- **小步提交** — 每次提交保持可编译、可验证
- **最小改动** — 只做请求的改动，不擅自"优化"周边代码

### 2.3 破坏性操作确认

以下操作需要**明确确认**后才能执行：

- 删除文件或大段代码
- 修改数据库 schema
- 执行 `git push`（特别是 main/master 分支）
- 安装/卸载依赖

---

## 3. 代码风格 (Code Style)

### 3.1 通用规则

- **注释语言**: 中文（简体）
- **命名**: 英文，遵循语言惯例（camelCase/snake_case）
- **格式化**: 使用项目既有的格式化工具和配置
- **Import**: 遵循项目既有的 import 顺序和分组

---

## 4. 测试要求 (Testing)

- **每次实现**必须提供测试或验证方式
- **测试覆盖**: 正常流程 + 边界条件 + 错误恢复
- **测试命名**: 清晰描述被测场景，例如 `test_login_with_invalid_password_returns_401`
- 缺失测试时，必须在交付中说明原因和补测计划

---

## 5. 工具与环境 (Tools & Environment)

### 5.1 开发环境

- **IDE**: <!-- 例如: VS Code / IntelliJ IDEA / Android Studio -->
- **终端**: <!-- 例如: iTerm2 / Windows Terminal / macOS Terminal -->
- **Shell**: <!-- 例如: zsh / bash / fish -->

### 5.2 构建工具

| 平台 | 工具 |
|------|------|
| Android | Gradle (Kotlin DSL) |
| iOS | Xcode / SPM |
| Web | pnpm / npm |
| Python | uv / pip |

### 5.3 版本控制

- **Git 工作流**: <!-- 例如: GitHub Flow / GitLab Flow / trunk-based -->
- **提交格式**: `type: message`，type 为 `feat|fix|refactor|chore|docs|test`
- **分支命名**: `feat/xxx` / `fix/xxx` / `chore/xxx`
